name: Deploy to NetSuite

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install SuiteCloud CLI (accept license)
        run: npm install -g @oracle/suitecloud-cli --acceptsuitecloudsdklicense

      - name: Configure NetSuite Authentication
        run: |
          mkdir -p ~/.suitecloud
          cat <<EOF > ~/.suitecloud/config.json
          {
            "defaultAuthId": "github-auth",
            "auths": {
              "github-auth": {
                "account": "${{ secrets.NS_ACCOUNT }}",
                "authType": "token",
                "tokenId": "${{ secrets.NS_TOKEN_ID }}",
                "tokenSecret": "${{ secrets.NS_TOKEN_SECRET }}",
                "consumerKey": "${{ secrets.NS_CONSUMER_KEY }}",
                "consumerSecret": "${{ secrets.NS_CONSUMER_SECRET }}"
              }
            }
          }
          EOF

      - name: Deploy to NetSuite
        run: suitecloud project:deploy
